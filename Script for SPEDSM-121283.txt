 DECLARE @dbLooper AS CURSOR,
         @dbName AS SYSNAME;

 SET @dbLooper = CURSOR FOR
  SELECT db.[name]
  FROM [TIENET].[dbo].[WorkspaceDirectory] AS wd
  INNER JOIN sys.databases AS db
    ON db.[name] = wd.[DatabaseName]
   AND db.[state] = 0
  WHERE db.name LIKE 'DC%'
     ORDER BY db.[name] ASC;

 OPEN @dbLooper;

 

 WHILE 1 = 1 BEGIN
  FETCH NEXT FROM @dbLooper
  INTO @dbName;

  IF @@FETCH_STATUS <> 0 BREAK;
  BEGIN -- USE workaround for dynamic SQL...
		IF  @dbName = 'DCTENANT1' USE [DCTENANT1];
		ELSE IF @dbName = 'DCTENANT2' USE [DCTENANT2];			
		ELSE CONTINUE;

  
  
  END

UPDATE EligibilityHistory Set InitialEligibilityOutcome = 
CASE
	WHEN C.Outcome = 'Eligible' THEN 2
	WHEN C.Outcome = 'Not Eligible' THEN 3
	WHEN C.Outcome = 'Parent denied consent' THEN 4
	WHEN C.Outcome = 'Discontinuation of Referral' THEN 1
END
FROM EligibilityHistory A
INNER JOIN Students B ON B.IDT# = A.Student
INNER JOIN DCCONTROL..Eligiblity121283 C ON C.USI = B.ID AND TRY_CONVERT(DATE, C.[Evaluation date], 101)= A.EvalDtHist 
WHERE (A.InitialEligibilityOutcome IS NULL OR A.InitialEligibilityOutcome = '') AND
TRY_CONVERT(DATE, C.[Evaluation date], 101) = A.EvalDtHist
--AND B.ID = '7020'
	

 END
 CLOSE @dbLooper;

 --SELECT * FROM DCCONTROL..Eligiblity121283






